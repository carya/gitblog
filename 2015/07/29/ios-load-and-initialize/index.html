
<!DOCTYPE html>
<html lang="en,zh-CN,default">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="CaryaLiu&#39;s blog">
    <title>iOS初探+load和+initialize - CaryaLiu&#39;s blog</title>
    <meta name="author" content="CaryaLiu">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"CaryaLiu","sameAs":[],"image":"header.png"},"articleBody":"+ initialize 和 + load 是\r\nNSObject\r\n类的两个类方法，它们会在运行时自动调用，我们可以利用其特性做一些初始化操作。\r\n可以先思考如下示例控制台应该输出什么:\r\n1234567891011121314151617//父类@interface People : NSObject@end@implementation People+ (void)initialize &#123;    NSLog(@&quot;%@ , %s&quot;, [self class], __FUNCTION__);&#125;@end//子类@interface Student : People@end@implementation Student+ (void)load &#123;    NSLog(@&quot;%@ , %s&quot;, [self class], __FUNCTION__);&#125;@end\r\n启动并运行程序，控制台应输出什么呢，见结尾处。\r\n\r\n本文主要从以下几个方面来记录:\r\n\r\ninitialize初探\r\nload初探\r\nload使用示例\r\n\r\ninitialize初探\r\n先看看 NSObject\r\nClass Reference 中关于 +initialize 的说明:\r\n\r\nInitializes the class before it receives its first message.\r\nThe runtime sends initialize to each class in a program just before\r\nthe class, or any class that inherits from it, is sent its first message\r\nfrom within the program. The runtime sends the initialize message to\r\nclasses in a thread-safe manner. Superclasses receive this message\r\nbefore their subclasses. The superclass implementation may be called\r\nmultiple times if subclasses do not implement initialize—the runtime\r\nwill call the inherited implementation—or if subclasses explicitly call\r\n[super initialize]. If you want to protect yourself from being run\r\nmultiple times, you can structure your implementation along these\r\nlines:\r\n12345+ (void)initialize &#123;  if (self == [ClassName self]) &#123;    // ... do the initialization ...  &#125;&#125;\r\ninitialize is invoked only once per class. If you want\r\nto perform independent initialization for the class and for categories\r\nof the class, you should implement load methods.\r\n\r\n从上面的说明可以看出:\r\n\r\n+ (void)initialize\r\n消息是在该类接收到其第一个消息之前调用。关于这里的第一个消息需要特别说明一下，对于\r\nNSObject 的 runtime 机制而言，其在调用\r\nNSObject 的 + (void)load\r\n消息不被视为第一个消息，但是，如果像普通函数调用一样直接调用\r\nNSObject 的 + (void)load 消息，则会引起\r\n+ (void)initialize 的调用。反之，如果没有向\r\nNSObject 发送第一个消息，+ (void)initialize\r\n则不会被自动调用。\r\n在应用程序的生命周期中，runtime 只会向每个类发送一次\r\n+ (void)initialize 消息，如果该类是子类，且该子类中没有实现\r\n+ (void)initialize 消息，或者子类显示调用父类实现\r\n[super initialize],\r\n那么则会调用其父类的实现。也就是说，父类的\r\n+ (void)initialize 可能会被调用多次。\r\n如果类包含分类，且分类重写了initialize方法，那么则会调用分类的\r\ninitialize 实现，而原类的该方法实现不会被调用，这个机制同\r\nNSObject 的其他方法(除 + (void)load 方法)\r\n一样，即如果原类同该类的分类包含有相同的方法实现，那么原类的该方法被隐藏而无法被调用。\r\n父类的 initialize 方法先于子类的\r\ninitialize 方法调用。\r\n\r\n做做下面的练习:\r\n123456789101112131415161718192021222324252627282930@interface People : NSObject@end@implementation People+ (void)initialize &#123;    NSLog(@&quot;%s&quot;, __FUNCTION__);&#125;@end@interface Student : People@end@implementation Student+ (void)initialize &#123;    NSLog(@&quot;%s&quot;, __FUNCTION__);&#125;@end@implementation ViewController- (void)viewDidLoad &#123;    [super viewDidLoad];    Student *student = [[Student alloc] init];&#125;@end\r\n运行程序会输出什么? 答案如下:\r\n12+[People initialize]+[Student initialize]\r\n上面示例可以看出子类会调用父类的 + initialize 方法。\r\n如果 ViewController 内的调用换成如下的方式,\r\n控制台输出又会是什么呢?\r\n1234567891011@implementation ViewController- (void)viewDidLoad &#123;    [super viewDidLoad];    Student *student = [[Student alloc] init];    NSLog(@&quot;viewDidLoad finished.&quot;);&#125;- (void)viewWillAppear:(BOOL)animated &#123;    [super viewWillAppear:animated];    Student *student = [[Student alloc] init];&#125;@end\r\n输出如下:\r\n123+[People initialize]+[Student initialize]viewDidLoad finished.\r\n上面示例可以看出，对于 runtime\r\n而言，+ initialize 方法在程序生命周期内只会调用一次。\r\n为 Student 添加分类如下:\r\n12345678910@interface Student (Score)@end@implementation Student (Score)+ (void)initialize &#123;    NSLog(@&quot;%s&quot;, __FUNCTION__);&#125;@end\r\n调用的地方修改如下:\r\n123456@implementation ViewController- (void)viewDidLoad &#123;    [super viewDidLoad];    Student *student = [[Student alloc] init];&#125;@end\r\n那么输出是什么呢? 如下:\r\n12+[People initialize]+[Student(Score) initialize]\r\n从该实例可以看出，分类的 +initialize 方法会覆盖原类中\r\n+initialize 方法。\r\nload初探\r\n先看看 NSObject\r\nClass Reference 中关于 + (void)load 的说明:\r\n\r\nInvoked whenever a class or category is added to the Objective-C\r\nruntime; implement this method to perform class-specific behavior upon\r\nloading.\r\nThe load message is sent to classes and categories that are both\r\ndynamically loaded and statically linked, but only if the newly loaded\r\nclass or category implements a method that can respond.\r\nThe order of initialization is as follows:\r\n\r\nAll initializers in any framework you link to.\r\nAll +load methods in your image.\r\nAll C++ static initializers and C/C++\r\nattribute(constructor) functions in your image.\r\nAll initializers in frameworks that link to you.\r\n\r\nIn addition:\r\n\r\nA class’s +load method is called after all of its superclasses’\r\n+load methods.\r\nA category +load method is called after the class’s own +load\r\nmethod.\r\n\r\nIn a custom implementation of load you can therefore safely message\r\nother unrelated classes from the same image, but any load methods\r\nimplemented by those classes may not have run yet.\r\n\r\n从上面的描述可以看出:\r\n\r\n+ (void)load 会在类或者类的分类添加到\r\nObjective-c runtime 时调用，该调用发生在\r\napplication:willFinishLaunchingWithOptions:\r\n调用之前调用。\r\n父类的 +load 方法先于子类的 +load\r\n方法调用，类本身的 +load 方法先于分类的 +load\r\n方法调用。\r\n\r\n看看下面的示例:\r\n示例1:\r\n12345678910111213141516171819202122232425262728293031323334//父类@interface People : NSObject@end@implementation People+ (void)initialize &#123;    NSLog(@&quot;%@ , %s&quot;, [self class], __FUNCTION__);&#125;+ (void)load &#123;    NSLog(@&quot;%@, %s&quot;, [self class], __FUNCTION__);&#125;@end//子类@interface Student : People@end@implementation Student+ (void)initialize &#123;    NSLog(@&quot;%@, %s&quot;, [self class], __FUNCTION__);&#125;+ (void)load &#123;    NSLog(@&quot;%@, %s&quot;, [self class], __FUNCTION__);&#125;@end//子类分类@interface Student (Score)@end@implementation Student (Score)+ (void)initialize &#123;    NSLog(@&quot;%@, %s&quot;, [self class], __FUNCTION__);&#125;+ (void)load &#123;    NSLog(@&quot;%@ %s&quot;, [self class], __FUNCTION__);&#125;@end\r\n控制台输出为:\r\n12345People , +[People initialize]People, +[People load]Student, +[Student(Score) initialize]Student, +[Student load]Student +[Student(Score) load]\r\n示例2:\r\n12345678910111213141516//父类@interface People : NSObject@end@implementation People+ (void)initialize &#123;    NSLog(@&quot;%@ , %s&quot;, [self class], __FUNCTION__);&#125;@end//子类@interface Student : People@end@implementation Student+ (void)load &#123;    NSLog(@&quot;%@, %s&quot;, [self class], __FUNCTION__);&#125;@end\r\n控制台输出为:\r\n123People , +[People initialize]Student , +[People initialize]Student, +[Student load]\r\n当子类没有实现 +initialize\r\n而父类有其实现时，父类的实现调用了两次，且 +initialize\r\n的调用在 +load 调用之前，这是因为我们在 +load\r\n实现中包含 [self class] 的调用。\r\n另外， 重写 +initialize 和 +load\r\n方法时，没有必要显示调用其父类的方法。\r\nload使用示例\r\nload使用示例1, 见 @sunnyxx 大神的博客 Notification\r\nOnce, 用于给 AppDelegate 瘦身。\r\nload使用示例2, 见博客 Method Swizzling\r\n和 AOP 实践, 在UIViewController的 +load\r\n时期执行IMP替换，实现AOP。\r\n\r\n本文开始出示例控制台输出:\r\n123People , +[People initialize]Student , +[People initialize]Student , +[Student load]\r\n参考:\r\nObjective\r\nC类方法load和initialize的区别\r\nObjective-C中的+initialize和+load\r\n\r\n目前已转行教育行业，欢迎加微信交流：CaryaLiu\r\n","dateCreated":"2015-07-29T21:24:59+08:00","dateModified":"2024-10-21T22:41:34+08:00","datePublished":"2015-07-29T21:24:59+08:00","description":"+ initialize 和 + load 是\r\nNSObject\r\n类的两个类方法，它们会在运行时自动调用，我们可以利用其特性做一些初始化操作。\r\n可以先思考如下示例控制台应该输出什么:\r\n1234567891011121314151617//父类@interface People : NSObject@end@implementation People+ (void)initialize &#123;    NSLog(@&quot;%@ , %s&quot;, [self class], __FUNCTION__);&#125;@end//子类@interface Student : People@end@implementation Student+ (void)load &#123;    NSLog(@&quot;%@ , %s&quot;, [self class], __FUNCTION__);&#125;@end\r\n启动并运行程序，控制台应输出什么呢，见结尾处。","headline":"iOS初探+load和+initialize","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"http://liumh.com/2015/07/29/ios-load-and-initialize/"},"publisher":{"@type":"Organization","name":"CaryaLiu","sameAs":[],"image":"header.png","logo":{"@type":"ImageObject","url":"header.png"}},"url":"http://liumh.com/2015/07/29/ios-load-and-initialize/","keywords":"iOS"}</script>
    <meta name="description" content="+ initialize 和 + load 是 NSObject 类的两个类方法，它们会在运行时自动调用，我们可以利用其特性做一些初始化操作。 可以先思考如下示例控制台应该输出什么: 1234567891011121314151617&#x2F;&#x2F;父类@interface People : NSObject@end@implementation People+ (void)initialize &amp;#">
<meta property="og:type" content="blog">
<meta property="og:title" content="iOS初探+load和+initialize">
<meta property="og:url" content="http://liumh.com/2015/07/29/ios-load-and-initialize/index.html">
<meta property="og:site_name" content="CaryaLiu&#39;s blog">
<meta property="og:description" content="+ initialize 和 + load 是 NSObject 类的两个类方法，它们会在运行时自动调用，我们可以利用其特性做一些初始化操作。 可以先思考如下示例控制台应该输出什么: 1234567891011121314151617&#x2F;&#x2F;父类@interface People : NSObject@end@implementation People+ (void)initialize &amp;#">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2015-07-29T13:24:59.000Z">
<meta property="article:modified_time" content="2024-10-21T14:41:34.432Z">
<meta property="article:author" content="CaryaLiu">
<meta property="article:tag" content="iOS">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="http://liumh.com/assets/images/header.png"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-zpenvh5cbgb1vzzlq3akzblrroxrej3zx0naeyxu1vn9s3kx3bsq9s1rbqce.min.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            CaryaLiu&#39;s blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/header.png" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/header.png" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">CaryaLiu</h4>
                
                    <h5 class="sidebar-profile-bio"><p><span class="citation"
data-cites="Chengdu">@Chengdu</span>，WeChat：CaryaLiu</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            iOS初探+load和+initialize
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2015-07-29T21:24:59+08:00">
	
		    Jul 29, 2015
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p><code>+ initialize</code> 和 <code>+ load</code> 是
<code>NSObject</code>
类的两个类方法，它们会在运行时自动调用，我们可以利用其特性做一些初始化操作。</p>
<p>可以先思考如下示例控制台应该输出什么:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//父类</span><br><span class="line">@interface People : NSObject</span><br><span class="line">@end</span><br><span class="line">@implementation People</span><br><span class="line">+ (void)initialize &#123;</span><br><span class="line">    NSLog(@&quot;%@ , %s&quot;, [self class], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">//子类</span><br><span class="line">@interface Student : People</span><br><span class="line">@end</span><br><span class="line">@implementation Student</span><br><span class="line">+ (void)load &#123;</span><br><span class="line">    NSLog(@&quot;%@ , %s&quot;, [self class], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>启动并运行程序，控制台应输出什么呢，见结尾处。</p>
<span id="more"></span>
<p>本文主要从以下几个方面来记录:</p>
<ul>
<li><a href="#understand-initialize">initialize初探</a></li>
<li><a href="#understand-load">load初探</a></li>
<li><a href="#load-example">load使用示例</a></li>
</ul>
<h3 id="understand-initialize">initialize初探</h3>
<p>先看看 <a
target="_blank" rel="noopener" href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/index.html#//apple_ref/occ/cl/NSObject">NSObject
Class Reference</a> 中关于 <code>+initialize</code> 的说明:</p>
<blockquote>
<p>Initializes the class before it receives its first message.</p>
<p>The runtime sends initialize to each class in a program just before
the class, or any class that inherits from it, is sent its first message
from within the program. The runtime sends the initialize message to
classes in a thread-safe manner. Superclasses receive this message
before their subclasses. The superclass implementation may be called
multiple times if subclasses do not implement initialize—the runtime
will call the inherited implementation—or if subclasses explicitly call
[super initialize]. If you want to protect yourself from being run
multiple times, you can structure your implementation along these
lines:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ (void)initialize &#123;</span><br><span class="line">  if (self == [ClassName self]) &#123;</span><br><span class="line">    // ... do the initialization ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>initialize</code> is invoked only once per class. If you want
to perform independent initialization for the class and for categories
of the class, you should implement <code>load</code> methods.</p>
</blockquote>
<p>从上面的说明可以看出:</p>
<ol type="1">
<li><code>+ (void)initialize</code>
消息是在该类接收到其第一个消息之前调用。关于这里的<strong>第一个消息</strong>需要特别说明一下，对于
<code>NSObject</code> 的 <code>runtime</code> 机制而言，其在调用
<code>NSObject</code> 的 <code>+ (void)load</code>
消息不被视为第一个消息，但是，如果像普通函数调用一样直接调用
<code>NSObject</code> 的 <code>+ (void)load</code> 消息，则会引起
<code>+ (void)initialize</code> 的调用。反之，如果没有向
<code>NSObject</code> 发送第一个消息，<code>+ (void)initialize</code>
则不会被自动调用。</li>
<li>在应用程序的生命周期中，<code>runtime</code> 只会向每个类发送一次
<code>+ (void)initialize</code> 消息，如果该类是子类，且该子类中没有实现
<code>+ (void)initialize</code> 消息，或者子类显示调用父类实现
<code>[super initialize]</code>,
那么则会调用其父类的实现。也就是说，父类的
<code>+ (void)initialize</code> 可能会被调用多次。</li>
<li>如果类包含分类，且分类重写了<code>initialize</code>方法，那么则会调用分类的
<code>initialize</code> 实现，而原类的该方法实现不会被调用，这个机制同
<code>NSObject</code> 的其他方法(除 <code>+ (void)load</code> 方法)
一样，即如果原类同该类的分类包含有相同的方法实现，那么原类的该方法被隐藏而无法被调用。</li>
<li>父类的 <code>initialize</code> 方法先于子类的
<code>initialize</code> 方法调用。</li>
</ol>
<p>做做下面的练习:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">@interface People : NSObject</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation People</span><br><span class="line"></span><br><span class="line">+ (void)initialize &#123;</span><br><span class="line">    NSLog(@&quot;%s&quot;, __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface Student : People</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation Student</span><br><span class="line"></span><br><span class="line">+ (void)initialize &#123;</span><br><span class="line">    NSLog(@&quot;%s&quot;, __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation ViewController</span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    Student *student = [[Student alloc] init];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>运行程序会输出什么? 答案如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+[People initialize]</span><br><span class="line">+[Student initialize]</span><br></pre></td></tr></table></figure>
<p>上面示例可以看出子类会调用父类的 <code>+ initialize</code> 方法。</p>
<p>如果 <code>ViewController</code> 内的调用换成如下的方式,
控制台输出又会是什么呢?</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@implementation ViewController</span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    Student *student = [[Student alloc] init];</span><br><span class="line">    NSLog(@&quot;viewDidLoad finished.&quot;);</span><br><span class="line">&#125;</span><br><span class="line">- (void)viewWillAppear:(BOOL)animated &#123;</span><br><span class="line">    [super viewWillAppear:animated];</span><br><span class="line">    Student *student = [[Student alloc] init];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>输出如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+[People initialize]</span><br><span class="line">+[Student initialize]</span><br><span class="line">viewDidLoad finished.</span><br></pre></td></tr></table></figure>
<p>上面示例可以看出，对于 <code>runtime</code>
而言，<code>+ initialize</code> 方法在程序生命周期内只会调用一次。</p>
<p>为 <code>Student</code> 添加分类如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@interface Student (Score)</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation Student (Score)</span><br><span class="line"></span><br><span class="line">+ (void)initialize &#123;</span><br><span class="line">    NSLog(@&quot;%s&quot;, __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>调用的地方修改如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@implementation ViewController</span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    Student *student = [[Student alloc] init];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>那么输出是什么呢? 如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+[People initialize]</span><br><span class="line">+[Student(Score) initialize]</span><br></pre></td></tr></table></figure>
<p>从该实例可以看出，分类的 <code>+initialize</code> 方法会覆盖原类中
<code>+initialize</code> 方法。</p>
<h3 id="understand-load">load初探</h3>
<p>先看看 <a
target="_blank" rel="noopener" href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/index.html#//apple_ref/occ/cl/NSObject">NSObject
Class Reference</a> 中关于 <code>+ (void)load</code> 的说明:</p>
<blockquote>
<p>Invoked whenever a class or category is added to the Objective-C
runtime; implement this method to perform class-specific behavior upon
loading.</p>
<p>The load message is sent to classes and categories that are both
dynamically loaded and statically linked, but only if the newly loaded
class or category implements a method that can respond.</p>
<p>The order of initialization is as follows:</p>
<ol type="1">
<li>All initializers in any framework you link to.</li>
<li>All +load methods in your image.</li>
<li>All C++ static initializers and C/C++
<strong>attribute</strong>(constructor) functions in your image.</li>
<li>All initializers in frameworks that link to you.</li>
</ol>
<p>In addition:</p>
<ul>
<li>A class’s +load method is called after all of its superclasses’
+load methods.</li>
<li>A category +load method is called after the class’s own +load
method.</li>
</ul>
<p>In a custom implementation of load you can therefore safely message
other unrelated classes from the same image, but any load methods
implemented by those classes may not have run yet.</p>
</blockquote>
<p>从上面的描述可以看出:</p>
<ol type="1">
<li><code>+ (void)load</code> 会在类或者类的分类添加到
<code>Objective-c runtime</code> 时调用，该调用发生在
<code>application:willFinishLaunchingWithOptions:</code>
调用之前调用。</li>
<li>父类的 <code>+load</code> 方法先于子类的 <code>+load</code>
方法调用，类本身的 <code>+load</code> 方法先于分类的 <code>+load</code>
方法调用。</li>
</ol>
<p>看看下面的示例:</p>
<p>示例1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">//父类</span><br><span class="line">@interface People : NSObject</span><br><span class="line">@end</span><br><span class="line">@implementation People</span><br><span class="line"></span><br><span class="line">+ (void)initialize &#123;</span><br><span class="line">    NSLog(@&quot;%@ , %s&quot;, [self class], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line">+ (void)load &#123;</span><br><span class="line">    NSLog(@&quot;%@, %s&quot;, [self class], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line">//子类</span><br><span class="line">@interface Student : People</span><br><span class="line">@end</span><br><span class="line">@implementation Student</span><br><span class="line">+ (void)initialize &#123;</span><br><span class="line">    NSLog(@&quot;%@, %s&quot;, [self class], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line">+ (void)load &#123;</span><br><span class="line">    NSLog(@&quot;%@, %s&quot;, [self class], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line">//子类分类</span><br><span class="line">@interface Student (Score)</span><br><span class="line">@end</span><br><span class="line">@implementation Student (Score)</span><br><span class="line">+ (void)initialize &#123;</span><br><span class="line">    NSLog(@&quot;%@, %s&quot;, [self class], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line">+ (void)load &#123;</span><br><span class="line">    NSLog(@&quot;%@ %s&quot;, [self class], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>控制台输出为:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">People , +[People initialize]</span><br><span class="line">People, +[People load]</span><br><span class="line">Student, +[Student(Score) initialize]</span><br><span class="line">Student, +[Student load]</span><br><span class="line">Student +[Student(Score) load]</span><br></pre></td></tr></table></figure>
<p>示例2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//父类</span><br><span class="line">@interface People : NSObject</span><br><span class="line">@end</span><br><span class="line">@implementation People</span><br><span class="line">+ (void)initialize &#123;</span><br><span class="line">    NSLog(@&quot;%@ , %s&quot;, [self class], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line">//子类</span><br><span class="line">@interface Student : People</span><br><span class="line">@end</span><br><span class="line">@implementation Student</span><br><span class="line">+ (void)load &#123;</span><br><span class="line">    NSLog(@&quot;%@, %s&quot;, [self class], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>控制台输出为:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">People , +[People initialize]</span><br><span class="line">Student , +[People initialize]</span><br><span class="line">Student, +[Student load]</span><br></pre></td></tr></table></figure>
<p>当子类没有实现 <code>+initialize</code>
而父类有其实现时，父类的实现调用了两次，且 <code>+initialize</code>
的调用在 <code>+load</code> 调用之前，这是因为我们在 <code>+load</code>
实现中包含 <code>[self class]</code> 的调用。</p>
<p>另外， 重写 <code>+initialize</code> 和 <code>+load</code>
方法时，没有必要显示调用其父类的方法。</p>
<h3 id="load使用示例">load使用示例</h3>
<p>load使用示例1, 见 <span class="citation"
data-cites="sunnyxx">@sunnyxx</span> 大神的博客 <a
target="_blank" rel="noopener" href="http://blog.sunnyxx.com/2015/03/09/notification-once/">Notification
Once</a>, 用于给 <code>AppDelegate</code> 瘦身。</p>
<p>load使用示例2, 见博客 <a
target="_blank" rel="noopener" href="http://tech.glowing.com/cn/method-swizzling-aop/">Method Swizzling
和 AOP 实践</a>, 在UIViewController的 <code>+load</code>
时期执行IMP替换，实现AOP。</p>
<hr />
<p>本文开始出示例控制台输出:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">People , +[People initialize]</span><br><span class="line">Student , +[People initialize]</span><br><span class="line">Student , +[Student load]</span><br></pre></td></tr></table></figure>
<p>参考:</p>
<p><a
target="_blank" rel="noopener" href="http://www.cnblogs.com/ider/archive/2012/09/29/objective_c_load_vs_initialize.html">Objective
C类方法load和initialize的区别</a></p>
<p><a
target="_blank" rel="noopener" href="http://zhangbuhuai.com/2015/04/28/initialize-and-load-in-Objective-C/">Objective-C中的+initialize和+load</a></p>
<hr />
<p>目前已转行教育行业，欢迎加微信交流：CaryaLiu</p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/iOS/" rel="tag">iOS</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2015/08/04/ios-init-window-rootviewcontroller/"
                    data-tooltip="iOS代码初始化window的rootViewController"
                    aria-label="PREVIOUS: iOS代码初始化window的rootViewController"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2015/07/26/ios-get-color-of-uiview/"
                    data-tooltip="iOS获取UIView上某点的颜色值"
                    aria-label="NEXT: iOS获取UIView上某点的颜色值"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2024 CaryaLiu. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2015/08/04/ios-init-window-rootviewcontroller/"
                    data-tooltip="iOS代码初始化window的rootViewController"
                    aria-label="PREVIOUS: iOS代码初始化window的rootViewController"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2015/07/26/ios-get-color-of-uiview/"
                    data-tooltip="iOS获取UIView上某点的颜色值"
                    aria-label="NEXT: iOS获取UIView上某点的颜色值"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                

            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/header.png" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">CaryaLiu</h4>
        
            <div id="about-card-bio"><p><span class="citation"
data-cites="Chengdu">@Chengdu</span>，WeChat：CaryaLiu</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Teacher</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Chengdu
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-cs5ywvosncuchmfbylvxzu6rf0pcfv37ilsjrqcvnjbcjeqx9g2hzm1ygmp1.min.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
